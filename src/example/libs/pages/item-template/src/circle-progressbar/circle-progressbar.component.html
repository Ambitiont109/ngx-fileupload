<!-- template for each upload -->
<ng-template #uploadCard let-upload="data" let-ctrl="ctrl">

    <div class="row">
        <div class="col col-auto progressbar">
            <app-ui--progressbar-circle 
                [circleData]="{height: 45, width: 45, radius: 20}"
                [progress]="upload.progress" >
            </app-ui--progressbar-circle>
        </div>
        <div class="col details">
            <dl>
                <dt class="label">Name</dt>
                <dd class="value text-truncate">{{upload.name}}</dd>
                <dt class="label">Size</dt>
                <dd class="value">{{upload.size}}</dd>
            </dl>

            <ul *ngIf="upload.state === 'error'" class="errors">
                <li *ngFor="let error of upload.response.errors | toArray" class="message error">
                    {{error}}
                </li>
            </ul>
        </div>
        <div class="col col-auto actions">

            <div class="btn-group">
                <app-ui--button (dispatch)="ctrl.start()" [label]="'Upload'" *ngIf="upload.state !== 'error'">
                    <i class="icon-left icon-upload"></i>
                </app-ui--button>

                <app-ui--button (dispatch)="ctrl.retry()" [label]="'Retry'" *ngIf="upload.state === 'error'">
                    <i class="icon-left icon-arrow-sync"></i>
                </app-ui--button>

                <app-ui--button (dispatch)="ctrl.stop()" [label]="'Abort'">
                    <i class="icon-left icon-cancel-outline"></i>
                </app-ui--button>
            </div>
        </div>
    </div>
</ng-template>


<div class="btn-toolbar mb-3">

    <div class="input-group ml-auto"
        [ngxFileUploadFile]="'http://localhost:3000/upload'"
        (add)="onUploadAdd($event)"
        (completed)="uploadCompleted($event)" #uploadFileFieldRef="ngxFileUploadRef">
        <div class="input-group-prepend">
            <div class="input-group-text" id="btnGroupAddon">Files</div>
        </div>
        <input type="text" class="form-control" disabled="disabled" placeholder="Drag Drop or Click">
    </div>

    <div class="btn-group ml-3">
        <button type="button" (click)="uploadFileFieldRef.uploadAll()" class="btn btn-sm btn-secondary">Upload All</button>
        <button type="button" (click)="uploadFileFieldRef.cancelAll()" class="btn btn-sm btn-secondary">Cancel All</button>
        <button type="button" (click)="uploadFileFieldRef.cleanAll()" class="btn  btn-sm btn-secondary">Clean Up</button>
    </div>
</div>

<!-- fileuploads goes here -->
<div class="upload-items">

    <ng-container *ngFor="let upload of uploads">
        <!-- completed lieber nach oben ziehen -->
        <ngx-fileupload-item [template]="uploadCard" [upload]="upload"></ngx-fileupload-item>
    </ng-container>
</div>